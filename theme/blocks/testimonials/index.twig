{# ACF Block: Testimonials #}
{% extends 'blocks/_base/block.twig' %}

{% set block_kicker   = fields.block_kicker ?? null %}
{% set block_title    = fields.block_title ?? null %}
{% set block_body     = fields.block_body  ?? null %}
{% set testimonials   = fields.testimonials    ?? [] %}

{% block block_content %}

{% set blockTextClassMap = {
	rich:     { blockKicker: 'text-yinmn', blockHeading: 'text-platinum', blockBody: 'text-gray-300' },
	yinmn:    { blockKicker: 'text-platinum/60', blockHeading: 'text-platinum', blockBody: 'text-platinum/80' },
	platinum: { blockKicker: 'text-yinmn', blockHeading: 'text-gray-900',  blockBody: 'text-gray-700' },
	_default: { blockKicker: 'text-silver', blockHeading: 'text-gray-900',  blockBody: 'text-gray-700' }
} %}

{% set current							 = blockTextClassMap[bg_color]|default(blockTextClassMap._default) %}
{% set blockKickerClass 		 = current.blockKicker %}
{% set blockHeadingClass 		 = current.blockHeading %}
{% set blockBodyClass    		 = current.blockBody %}

{% set cardMap = {
  rich:     { card: 'bg-yinmn', icon: 'bg-oxford' },
  yinmn:    { card: 'bg-oxford', icon: 'bg-rich'   },
  platinum: { card: 'bg-yinmn', icon: 'bg-oxford' },
  _default: { card: 'bg-yinmn', icon: 'bg-oxford' }
} %}

{% set cardVariant = cardMap[bg_color]|default(cardMap._default) %}
{% set featureCardClass = cardVariant.card %}
{% set featureCardIconClass = cardVariant.icon %}

{# {{ dump(fields) }} #}
  
  <div class="grid grid-cols-1 md:grid-cols-2 items-center gap-8 max-w-6xl mx-auto">
    <div class="col-span-1">
      <div class="text-center md:text-left mx-auto md:max-w-3/4">
        {% if block_kicker or block_title %}
          <div class="space-y-2">
            {% include 'components/kicker/kicker.twig' with {
              kicker: {
                text: block_kicker,
                classes: blockKickerClass
              }
            } %}
            {% include 'components/heading/heading.twig' with {
              heading: {
                tag: 'h2',
                text: block_title,
                classes: blockHeadingClass,
              }
            } %}
          </div>
        {% endif %}
        {% include 'components/rich-text/rich-text.twig' with {
          richText: {
            content: block_body,
            classes: blockBodyClass ~ ' mt-4',
            sanitize: true
          }
        } %}
        {% include 'components/button/button.twig' with {
          button: {
            text: 'View Case Studies',
            url: '#',
            classes: 'mt-6',
            variant: 'primary'
          }
        } %}
      </div>
    </div>
    {% if testimonials %}
      <div class="col-span-1 space-y-4 md:space-y-8">
        {% for item in testimonials %}
          {% set img = item.image %}
          <blockquote class="space-y-4 w-full col-span-1 p-6 bg-white rounded-lg border-[1px] border-gray-100 shadow">
            <div class="flex items-center justify-between">
              <div class="flex flex-col gap-4 pr-8">
              <div class="relative pl-12">
                <svg class="absolute left-0 w-10 h-10 text-yinmn fill-current"
                  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 125">
                  <path
                    d="M30.7 42c0 6.1 12.6 7 12.6 22 0 11-7.9 19.2-18.9 19.2C12.7 83.1 5 72.6 5 61.5c0-19.2 18-44.6 29.2-44.6 2.8 0 7.9 2 7.9 5.4S30.7 31.6 30.7 42zM82.4 42c0 6.1 12.6 7 12.6 22 0 11-7.9 19.2-18.9 19.2-11.8 0-19.5-10.5-19.5-21.6 0-19.2 18-44.6 29.2-44.6 2.8 0 7.9 2 7.9 5.4S82.4 31.6 82.4 42z" />
                </svg>
                {% include 'components/rich-text/rich-text.twig' with {
                  richText: {
                    content: item.quote,
                    classes: 'text-gray-700',
                    sanitize: true
                  }
                } %}
              </div>
            </div>
              {% if img and img.url %}
                <figure class="flex-shrink-0 w-20 h-20 xl:w-24 xl:h-24">
                  <picture>
                    <img
                      class="w-full h-full rounded-full"
                      src="{{ img.sizes['thumbnail'] ?? img.url }}"
                      srcset="
                        {{ img.sizes['thumbnail'] ?? '' }} 768w,
                        {{ img.sizes['thumbnail'] ?? '' }} 1024w,
                        {{ img.url }} {{ img.width }}w"
                      sizes="(min-width: 768px) 50vw, 100vw"
                      width="{{ img.width }}"
                      height="{{ img.height }}"
                      alt="{{ img.alt ?: img.title }}"
                      loading="lazy"
                      decoding="async"
                    >
                  </picture>
                  
                </figure>
              {% endif %}
            </div>
            
              <div class="flex gap-2 items-end">
                {% include 'components/heading/heading.twig' with {
                  heading: {
                    tag: 'h3',
                    classes: 'c-heading--h4',
                    text: item.name
                  }
                } %}
                {% if item.company %}
                  <span class="text-sm text-gray-500 truncate">- {{ item.company }}</span>
                {% endif %}
              </div>
          </blockquote>
        {% endfor %}
      </div>
    {% endif %}
    
  </div>

{% endblock %}
		