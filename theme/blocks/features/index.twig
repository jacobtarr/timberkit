{# ACF Block: Features #}
{% extends 'blocks/_base/block.twig' %}

{% set block_title = fields.block_title ?? null %}
{% set block_body  = fields.block_body  ?? null %}
{% set items       = fields.features    ?? [] %}

{% block block_content %}

{% set blockTextClassMap = {
	rich:     { blockHeading: 'text-platinum', blockBody: 'text-gray-300' },
	yinmn:    { blockHeading: 'text-platinum', blockBody: 'text-platinum/80' },
	platinum: { blockHeading: 'text-gray-900',  blockBody: 'text-gray-700' },
	_default: { blockHeading: 'text-gray-900',  blockBody: 'text-gray-700' }
} %}

{% set current							 = blockTextClassMap[bg_color]|default(blockTextClassMap._default) %}
{% set blockHeadingClass 		 = current.blockHeading %}
{% set blockBodyClass    		 = current.blockBody %}

{% set cardMap = {
  rich:     { card: 'bg-yinmn', icon: 'bg-oxford' },
  yinmn:    { card: 'bg-oxford', icon: 'bg-rich'   },
  platinum: { card: 'bg-yinmn', icon: 'bg-oxford' },
  _default: { card: 'bg-yinmn', icon: 'bg-oxford' }
} %}

{% set cardVariant = cardMap[bg_color]|default(cardMap._default) %}
{% set featureCardClass = cardVariant.card %}
{% set featureCardIconClass = cardVariant.icon %}

  <div class="text-center space-y-8 md:space-y-12">
    {% if block_title or block_body %}
      <div class="space-y-3 max-w-3xl mx-auto">
        {% include 'components/heading/heading.twig' with {
          heading: {
            tag: 'h2',
            text: block_title,
            classes: blockHeadingClass,
          }
        } %}
        {% include 'components/rich-text/rich-text.twig' with {
          richText: {
            content: block_body,
            classes: blockBodyClass ~ ' mx-auto',
            sanitize: true
          }
        } %}
      </div>
    {% endif %}
    {% if items %}
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-8 max-w-5xl mx-auto">
        {% for item in items %}
          <div class="h-full text-center flex flex-col items-center gap-4 rounded-xl p-6 md:p-8 {{ featureCardClass }}">
            {% set icon = item.icon ?? null %}
            {% if icon %}
              <figure class="w-12 h-12 p-3 rounded-full flex items-center justify-center {{ featureCardIconClass }}">
                {% if icon.subtype == 'svg+xml' %}
                  {{ inline_svg(icon, { class:'w-8 h-8', title:'' }) }}
                {% else %}
                  <img
                  width="32" height="32"
                  src="{{ icon.url }}"
                  alt="{{ icon.alt|default('') }}"
                  class="w-8 h-8 object-contain"
                  loading="lazy">
                {% endif %}
              </figure>
            {% endif %}
						{% include 'components/heading/heading.twig' with {
							heading: {
								tag: 'h3',
								text: item.title,
								classes: 'c-heading--h4 text-platinum',
							}
						} %}
						{% include 'components/rich-text/rich-text.twig' with {
							richText: {
								content: item.description,
								classes: 'text-base text-platinum/80',
								sanitize: true
							}
						} %}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>
{% endblock %}
		